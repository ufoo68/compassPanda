# はじめに
このレポジトリはLINE Bot「コンパスパンダ」のソースコードが保管されています。

# コンパスパンダについて
コンパスパンダは**その時・その場所**で思ったみんなの**呟き**を残すためのLINE Botサービスです。  

![img](./assets/イメージ図.png "イメージ図")

このようにしてみんなの呟きが地図の上に現れることで、一つの地図アプリになっていきます。そして、後からその地域にやってくる人を案内するための**コンパス**が完成されていきます。

# Botの使い方
![img](./assets/QR.png "QR")  
友達追加はこのQRコードからできます。  
登録ができたら早速トーク画面を開いてください。  
![img](./assets/start.jpg "スタート画面")   

↑こんな感じのトーク画面が開かれます。使い方の説明は、赤枠で囲んだアイコンをタップしてみると教えてくれます。  

![img](./assets/usage.jpg "使い方")   

早速呟いてみたいので、説明の通り**位置情報を送信**してみます。赤枠のところをタップしてキーボードメニューに切り替えます。  

![img](./assets/keyboad.jpg "キーボード")  

キーボードメニューに切り替わったので赤枠内のところをタップしてみます。  

![img](./assets/selectLocate.jpg "選択画面")

続けて赤枠内のところをタップすると位置情報の送信ができます。

![img](./assets/locate.jpg "位置情報送信")  

**自分のいるところ**を選択しましょう。

![img](./assets/locateDone.jpg "位置情報送信後")  

位置情報を送信すると、色々とメッセージが送られてきます。青矢印で示している「line://」から始まるURLをタップすると**呟き**をするためのフォームが開きます。  
このとき赤枠内で示している数字が**自分の位置情報**と**呟き**の情報を紐づけるためのキーとなるので、そのまま番号（ここでは**タイムスタンプ**と呼んでいます）をコピーをしてください。  

![img](./assets/form.jpg "位置情報送信後")  

フォームが開いたら、先ほどコピーした**タイムスタンプの番号**を上の欄に、**呟きたいこと**を下のテキストエリアに入力してそのまま「送信」を押して下さい。送信に成功すればそのままフォームが自動で閉じられます。閉じられなかった場合は送信に失敗しているので、お手数ですがもう一度入力をして送信してください。  
このときテキストエリアには「:」の文字が入らないようにしてください。システムの特性上、「:」が呟きのフォームに含まれていると、テキストの送信に成功しても**コンパスパンダが「呟き」として認識してくれません**    

![img](./assets/tweet.jpg "フォーム送信後")  

呟きの送信に成功すると↑のようなメッセージが送られてきます。そのまま呟きを確認したいので、今度はリッチメニューに戻ります。赤枠内のところをタップしてください。  

![img](./assets/menuMap.jpg "リッチメニュー再び")  

リッチメニューに切り替わるので、今度は赤枠内で囲んだアイコンをタップしてみましょう。  

![img](./assets/maping.jpg "地図")  

そのまま地図が現れてくると思います。先ほど**呟きを残した**場所に立っているマーカーをタップしてみると呟きが確認できます。  

## こぼれ話

![img](./assets/chat.jpg "トーク例")  

コンパスパンダは普通のLINE Botなのでおしゃべりチャット機能もあります。何かしらのメッセージを送ってみると返事を返してくれます。  
また、**ある特定の言葉**が含まれたメッセージをおくるとレアな返事を返してくれるときも...?

# 技術的なお話
LINE Botの開発にはLINE株式会社が提供する[Messaging API](https://developers.line.biz/ja/services/messaging-api/)と[line-bot-sdk-nodejs](https://github.com/line/line-bot-sdk-nodejs)を使いました。また、LINEのトーク画面上に現れる**フォーム画面**と**地図**は[LIFF](https://developers.line.biz/ja/docs/liff/overview/)という仕組みが用いられています。フォーム画面のソースコードは[ここ](https://github.com/ufoo68/compassPandaForm)に、地図表示のソースコードは[ここ](https://github.com/ufoo68/compass-panda-leaflet)に保管されています。  
詳しい解説は[ここの記事]()で解説しています（準備中）。